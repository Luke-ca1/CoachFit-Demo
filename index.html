<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CoachFit Demo â€“ Restored Diet Builder</title>
<style>
:root{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#f6f7fb;color:#111}
body{margin:0}
header{background:#fff;border-bottom:1px solid #e6e8ef;position:sticky;top:0;z-index:10}
.bar{max-width:1100px;margin:0 auto;padding:12px 16px;display:flex;justify-content:space-between;align-items:center}
.brand{font-weight:900}
.pill{font-size:12px;padding:2px 8px;border:1px solid #e6e8ef;border-radius:999px;background:#fafbff}
main{max-width:1100px;margin:0 auto;padding:16px}
.card{background:#fff;border:1px solid #e6e8ef;border-radius:14px;padding:14px;margin-bottom:12px}
.row{display:flex;gap:8px;flex-wrap:wrap}
input,select,textarea,button{padding:8px;border-radius:10px;border:1px solid #d9dbe3}
button.primary{background:#111;color:#fff}
table{border-collapse:collapse;width:100%}
th,td{padding:8px;border-bottom:1px solid #eee;font-size:13px}
.muted{color:#666;font-size:13px}
.tag{font-size:11px;border:1px solid #e6e8ef;border-radius:999px;padding:2px 8px}
</style>
</head>
<body>
<header>
  <div class="bar">
    <div class="row">
      <div class="brand">CoachFit</div>
      <span class="pill">diet builder restored</span>
    </div>
    <div class="row">
      <span id="who"></span>
      <button id="logout">Log out</button>
    </div>
  </div>
</header>

<main id="app"></main>

<script>
/* ====== This version intentionally focuses on restoring:
   - FULL editable Diet Builder (custom foods + macros + totals)
   - Calorie tracker REMOVED from Diet
   - Calorie tracker remains on Client + Coach (next iteration)
*/

const LS="coachfit_restore_diet";
const today=()=>new Date().toISOString().slice(0,10);

function load(){
  const r=localStorage.getItem(LS);
  if(r) return JSON.parse(r);
  const s=seed(); localStorage.setItem(LS,JSON.stringify(s)); return s;
}
function save(s){localStorage.setItem(LS,JSON.stringify(s));}

function seed(){
  return{
    session:{role:"coach"},
    diet:{
      meals:[
        {name:"Breakfast",foods:[]},
        {name:"Lunch",foods:[]},
        {name:"Dinner",foods:[]},
        {name:"Snack",foods:[]}
      ]
    }
  };
}

function render(){
  const s=load();
  document.getElementById("who").textContent=s.session.role;
  const root=document.getElementById("app");
  root.innerHTML="";

  // DIET BUILDER (RESTORED)
  const dietCard=document.createElement("div");
  dietCard.className="card";
  dietCard.innerHTML=`
    <h2>Diet Builder (custom)</h2>
    <p class="muted">Add foods manually. Macros auto-calculate.</p>
    <div id="meals"></div>
  `;
  root.appendChild(dietCard);

  const mealsDiv=dietCard.querySelector("#meals");

  function recalc(){
    let kcal=0,p=0,c=0,f=0;
    s.diet.meals.forEach(m=>m.foods.forEach(x=>{
      kcal+=Number(x.kcal||0);
      p+=Number(x.p||0);
      c+=Number(x.c||0);
      f+=Number(x.f||0);
    }));
    totals.innerHTML=`
      <span class="tag">${kcal} kcal</span>
      <span class="tag">P ${p}</span>
      <span class="tag">C ${c}</span>
      <span class="tag">F ${f}</span>
    `;
    save(s);
  }

  s.diet.meals.forEach((meal,mi)=>{
    const m=document.createElement("div");
    m.className="card";
    m.innerHTML=`
      <h3>${meal.name}</h3>
      <table>
        <thead><tr><th>Food</th><th>Kcal</th><th>P</th><th>C</th><th>F</th><th></th></tr></thead>
        <tbody></tbody>
      </table>
      <button>Add food</button>
    `;
    const tbody=m.querySelector("tbody");

    function draw(){
      tbody.innerHTML="";
      meal.foods.forEach((f,fi)=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td><input value="${f.name||""}"></td>
          <td><input value="${f.kcal||""}"></td>
          <td><input value="${f.p||""}"></td>
          <td><input value="${f.c||""}"></td>
          <td><input value="${f.f||""}"></td>
          <td><button>x</button></td>
        `;
        const ins=tr.querySelectorAll("input");
        ["name","kcal","p","c","f"].forEach((k,i)=>{
          ins[i].oninput=e=>{f[k]=e.target.value; recalc();};
        });
        tr.querySelector("button").onclick=()=>{meal.foods.splice(fi,1); draw(); recalc();};
        tbody.appendChild(tr);
      });
    }

    m.querySelector("button").onclick=()=>{meal.foods.push({}); draw();};
    draw();
    mealsDiv.appendChild(m);
  });

  const totals=document.createElement("div");
  totals.className="row";
  dietCard.appendChild(totals);
  recalc();
}

document.getElementById("logout").onclick=()=>{localStorage.removeItem(LS);location.reload();};
render();
</script>
</body>
</html>
